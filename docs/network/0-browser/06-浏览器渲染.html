<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端浏览器渲染原理</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="前端浏览器渲染原理">
    <meta name="keywords" content="前端浏览器渲染原理,浏览器渲染,渲染过程,回流,重绘,async,defer">
    <meta name="author" content="liam">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.e2f44ae9.css" as="style"><link rel="preload" href="/assets/js/app.fdbd3a7d.js" as="script"><link rel="preload" href="/assets/js/2.c135791f.js" as="script"><link rel="preload" href="/assets/js/1.ef243348.js" as="script"><link rel="preload" href="/assets/js/41.0252e8a3.js" as="script"><link rel="prefetch" href="/assets/js/10.fac04ee2.js"><link rel="prefetch" href="/assets/js/11.df95b6d6.js"><link rel="prefetch" href="/assets/js/12.d322d79f.js"><link rel="prefetch" href="/assets/js/13.d461d101.js"><link rel="prefetch" href="/assets/js/14.eee8ad98.js"><link rel="prefetch" href="/assets/js/15.2da99dce.js"><link rel="prefetch" href="/assets/js/16.8066bbcc.js"><link rel="prefetch" href="/assets/js/17.0f456d45.js"><link rel="prefetch" href="/assets/js/18.87a15af9.js"><link rel="prefetch" href="/assets/js/19.8bf1456f.js"><link rel="prefetch" href="/assets/js/20.8e68410b.js"><link rel="prefetch" href="/assets/js/21.dbe112a9.js"><link rel="prefetch" href="/assets/js/22.f152b048.js"><link rel="prefetch" href="/assets/js/23.5f51756a.js"><link rel="prefetch" href="/assets/js/24.eafe48b1.js"><link rel="prefetch" href="/assets/js/25.02eda376.js"><link rel="prefetch" href="/assets/js/26.3d00d40b.js"><link rel="prefetch" href="/assets/js/27.98f181f5.js"><link rel="prefetch" href="/assets/js/28.ad631fc4.js"><link rel="prefetch" href="/assets/js/29.b9dd2f73.js"><link rel="prefetch" href="/assets/js/3.2be8686e.js"><link rel="prefetch" href="/assets/js/30.ac2f9ca3.js"><link rel="prefetch" href="/assets/js/31.7b0dc993.js"><link rel="prefetch" href="/assets/js/32.36cfbdda.js"><link rel="prefetch" href="/assets/js/33.de52c7e1.js"><link rel="prefetch" href="/assets/js/34.e3acfb01.js"><link rel="prefetch" href="/assets/js/35.fa488a03.js"><link rel="prefetch" href="/assets/js/36.5ec5b495.js"><link rel="prefetch" href="/assets/js/37.defa9fca.js"><link rel="prefetch" href="/assets/js/38.c10c335d.js"><link rel="prefetch" href="/assets/js/39.b94d4635.js"><link rel="prefetch" href="/assets/js/4.9be6b6a0.js"><link rel="prefetch" href="/assets/js/40.c80d1540.js"><link rel="prefetch" href="/assets/js/42.bafa2252.js"><link rel="prefetch" href="/assets/js/43.a92a8c38.js"><link rel="prefetch" href="/assets/js/44.036b9bbd.js"><link rel="prefetch" href="/assets/js/45.932a99da.js"><link rel="prefetch" href="/assets/js/46.f09b813d.js"><link rel="prefetch" href="/assets/js/47.1480826c.js"><link rel="prefetch" href="/assets/js/48.13966581.js"><link rel="prefetch" href="/assets/js/49.4891ceb5.js"><link rel="prefetch" href="/assets/js/5.740bd581.js"><link rel="prefetch" href="/assets/js/50.f013af64.js"><link rel="prefetch" href="/assets/js/51.e18a236f.js"><link rel="prefetch" href="/assets/js/52.119fc6e0.js"><link rel="prefetch" href="/assets/js/53.b0675f90.js"><link rel="prefetch" href="/assets/js/54.0e15abb1.js"><link rel="prefetch" href="/assets/js/55.2af4c93e.js"><link rel="prefetch" href="/assets/js/56.e753164e.js"><link rel="prefetch" href="/assets/js/57.fba77abc.js"><link rel="prefetch" href="/assets/js/58.f8cf67e3.js"><link rel="prefetch" href="/assets/js/59.7131c32e.js"><link rel="prefetch" href="/assets/js/6.b59cd7d8.js"><link rel="prefetch" href="/assets/js/60.8581d2d7.js"><link rel="prefetch" href="/assets/js/61.20226f1d.js"><link rel="prefetch" href="/assets/js/62.254d9ae8.js"><link rel="prefetch" href="/assets/js/63.45b87153.js"><link rel="prefetch" href="/assets/js/64.c71a7f6f.js"><link rel="prefetch" href="/assets/js/65.d5fead4d.js"><link rel="prefetch" href="/assets/js/66.414ea1ae.js"><link rel="prefetch" href="/assets/js/67.21230f8e.js"><link rel="prefetch" href="/assets/js/68.02a17eb1.js"><link rel="prefetch" href="/assets/js/69.5cb10b3a.js"><link rel="prefetch" href="/assets/js/7.f54d7af6.js"><link rel="prefetch" href="/assets/js/70.c9fdf696.js"><link rel="prefetch" href="/assets/js/71.8064a150.js"><link rel="prefetch" href="/assets/js/72.4ab06319.js"><link rel="prefetch" href="/assets/js/73.a6dd0d8f.js"><link rel="prefetch" href="/assets/js/74.1f24a32f.js"><link rel="prefetch" href="/assets/js/75.19e4505d.js"><link rel="prefetch" href="/assets/js/76.ab6c86a0.js"><link rel="prefetch" href="/assets/js/77.1ce9dc61.js"><link rel="prefetch" href="/assets/js/78.e0ab9e4e.js"><link rel="prefetch" href="/assets/js/79.041b24ad.js"><link rel="prefetch" href="/assets/js/80.7e85dcac.js"><link rel="prefetch" href="/assets/js/81.c070cff6.js"><link rel="prefetch" href="/assets/js/82.05206f1b.js"><link rel="prefetch" href="/assets/js/83.58015a46.js"><link rel="prefetch" href="/assets/js/84.d65cc23d.js"><link rel="prefetch" href="/assets/js/85.aa8c60c9.js"><link rel="prefetch" href="/assets/js/86.670a93b3.js"><link rel="prefetch" href="/assets/js/87.4b8c6571.js"><link rel="prefetch" href="/assets/js/88.d0e60af8.js"><link rel="prefetch" href="/assets/js/89.fd1d2e29.js"><link rel="prefetch" href="/assets/js/90.28d64579.js"><link rel="prefetch" href="/assets/js/91.88717d89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.92fa0d62.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2f44ae9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header-logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/network/" class="nav-link router-link-active">
  网络
</a></div><div class="nav-item"><a href="/frame/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/huoyuhao/huoyuhao.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/network/" class="nav-link router-link-active">
  网络
</a></div><div class="nav-item"><a href="/frame/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/huoyuhao/huoyuhao.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>browser</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/0-browser/00-性能优化.html" class="sidebar-link">性能优化</a></li><li><a href="/network/0-browser/01-浏览器内核.html" class="sidebar-link">浏览器内核</a></li><li><a href="/network/0-browser/02-DNS预解析.html" class="sidebar-link">DNS预解析</a></li><li><a href="/network/0-browser/02-浏览器DNS解析.html" class="sidebar-link">浏览器DNS解析</a></li><li><a href="/network/0-browser/03-跨域.html" class="sidebar-link">跨域</a></li><li><a href="/network/0-browser/04-Cookie.html" class="sidebar-link">Cookie</a></li><li><a href="/network/0-browser/04-浏览器存储.html" class="sidebar-link">浏览器存储</a></li><li><a href="/network/0-browser/05-浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/network/0-browser/06-浏览器渲染.html" class="active sidebar-link">浏览器渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_1-浏览器渲染过程" class="sidebar-link">1. 浏览器渲染过程</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_2-dom树构建" class="sidebar-link">2. DOM树构建</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_3-cssom树构建" class="sidebar-link">3. CSSOM树构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_3-1-css-的层叠性" class="sidebar-link">3.1 CSS 的层叠性</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_3-2-css的继承性" class="sidebar-link">3.2 CSS的继承性</a></li></ul></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_4-渲染树构建" class="sidebar-link">4. 渲染树构建</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_5-渲染树布局" class="sidebar-link">5. 渲染树布局</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_5-1-分层" class="sidebar-link">5.1 分层</a></li></ul></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_6-渲染树绘制" class="sidebar-link">6. 渲染树绘制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_6-1-栅格化-raster" class="sidebar-link">6.1 栅格化(raster)</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_6-2-合成和显示" class="sidebar-link">6.2 合成和显示</a></li></ul></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_7-渲染流水线总结" class="sidebar-link">7. 渲染流水线总结</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_8-回流与重绘" class="sidebar-link">8. 回流与重绘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_8-1-回流-重排-reflow" class="sidebar-link">8.1 回流/重排（Reflow）</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_8-2-常见引起回流-重排属性的方法" class="sidebar-link">8.2 常见引起回流/重排属性的方法</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_8-3-重绘-重绘-repaint" class="sidebar-link">8.3 重绘/重绘（Repaint）</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_8-4-回流与重绘的关系" class="sidebar-link">8.4 回流与重绘的关系</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_8-5-浏览器的渲染队列" class="sidebar-link">8.5 浏览器的渲染队列</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_8-6-优化策略" class="sidebar-link">8.6 优化策略</a></li></ul></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_9-渲染性能监控" class="sidebar-link">9. 渲染性能监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_9-1-使用performance-api" class="sidebar-link">9.1 使用Performance API</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#_9-2-使用lighthouse进行性能分析" class="sidebar-link">9.2 使用Lighthouse进行性能分析</a></li><li class="sidebar-sub-header"><a href="/network/0-browser/06-浏览器渲染.html#参考文章" class="sidebar-link">参考文章</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>network</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端浏览器渲染原理"><a href="#前端浏览器渲染原理" class="header-anchor">#</a> 前端浏览器渲染原理</h1> <h2 id="_1-浏览器渲染过程"><a href="#_1-浏览器渲染过程" class="header-anchor">#</a> 1. 浏览器渲染过程</h2> <p>浏览器渲染页面的整个过程可以分为以下几个步骤：</p> <ol><li>解析HTML生成DOM树</li> <li>解析CSS生成CSSOM树</li> <li>将DOM树和CSSOM树合并生成渲染树</li> <li>布局计算</li> <li>绘制到屏幕</li></ol> <h2 id="_2-dom树构建"><a href="#_2-dom树构建" class="header-anchor">#</a> 2. DOM树构建</h2> <p>浏览器会将HTML文档解析成一个由DOM元素组成的树形结构，即DOM树。解析过程中，遇到script标签会阻塞DOM树的构建，直到脚本执行完毕。</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8DOM%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B.png" alt="浏览器DOM构建过程"></p> <ul><li><strong>转换：</strong> 浏览器从磁盘或网络读取HTML的原始字节，并根据文件的指定编码（例如 UTF-8）将它们转换成字符串。在网络中传输的内容其实都是 0 和 1 这些字节数据。当浏览器接收到这些字节数据以后，它会将这些字节数据转换为字符串，也就是我们写的代码。</li> <li><strong>令牌化：</strong> 将字符串转换成Token，例如：<code>&lt;html&gt;、&lt;body&gt;</code>等。Token中会标识出当前Token是“开始标签”或是“结束标签”亦或是“文本”等信息</li> <li><strong>词法分析：</strong> 发出的令牌转换成定义其属性和规则的“对象”</li> <li><strong>DOM构建：</strong> 由于 HTML 标记定义不同标记之间的关系（一些标记包含在其他标记内），创建的对象链接在一个树数据结构内，此结构也会捕获原始标记中定义的父项-子项关系：HTML 对象是 body 对象的父项，body 是 paragraph 对象的父项，依此类推。</li></ul> <h2 id="_3-cssom树构建"><a href="#_3-cssom树构建" class="header-anchor">#</a> 3. CSSOM树构建</h2> <p>与处理 HTML 时一样，我们需要将收到的 CSS 规则转换成某种浏览器能够理解和处理的东西。因此，我们会重复 HTML 过程，不过是为 CSS 而不是 HTML：</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8CSSOM%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B-1.png" alt="浏览器CSSOM构建过程"></p> <p>CSS 字节转换成字符，接着转换成令牌和节点，最后链接到一个称为“CSS 对象模型”(CSSOM) 的树结构内</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8CSSOM%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B-2.png" alt="浏览器CSSOM构建过程"></p> <p>浏览器解析css过程是阻塞的，浏览器需要解析完所有的css才会使用css样式(和浏览器的回流重绘一样)</p> <p>CSS它只显示了我们决定在样式表中替换的样式。每个浏览器都提供一组默认样式（也称为User Agent 样式），即我们不提供任何自定义样式时所看到的样式，我们的样式只是替换这些默认样式（<a href="http://www.iecss.com/" target="_blank" rel="noopener noreferrer">例如默认 IE 样式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p> <h3 id="_3-1-css-的层叠性"><a href="#_3-1-css-的层叠性" class="header-anchor">#</a> 3.1 CSS 的层叠性</h3> <p><strong>层叠性</strong>
该层叠将获取给定元素上给定属性的声明值的无序列表，按声明的优先级对它们进行排序，并输出单个层叠值。</p> <p>当多个相互冲突的CSS声明应用于同一个元素时，CSS层叠算法会根据一定的机制，从最高权重到最低权重的顺序列出著作权归作者所有，具体如下：</p> <p>来源和重要性 -&gt; 选择器权重 -&gt; 出现的顺序 -&gt; 初始和继承属性（默认值）</p> <h3 id="_3-2-css的继承性"><a href="#_3-2-css的继承性" class="header-anchor">#</a> 3.2 CSS的继承性</h3> <p><strong>继承性</strong>
当元素的一个继承属性没有指定值时，则取父元素的同属性的计算值。只有文档根元素取该属性的概述中给定的初始值</p> <p>color、 text-开头的、line-开头的、font-开头的样式可以被继承</p> <h2 id="_4-渲染树构建"><a href="#_4-渲染树构建" class="header-anchor">#</a> 4. 渲染树构建</h2> <p>浏览器将 DOM 和 CSSOM 合并成一个“渲染树”，网罗网页上所有可见的 DOM 内容，以及每个节点的所有 CSSOM 样式信息</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%A0%91%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B.png" alt="浏览器渲染树构建过程"></p> <p>为构建渲染树，浏览器大体上完成了下列工作：</p> <ol><li><p>从 DOM 树的根节点开始遍历每个可见节点</p> <ul><li>某些节点不可见（例如脚本标记、元标记等），因为它们不会体现在渲染输出中，所以会被忽略。</li> <li>某些节点通过 CSS 隐藏，因此在渲染树中也会被忽略，例如，上例中的 span 节点不会出现在渲染树中，因为有一个显式规则在该节点上设置了“display: none”属性</li></ul></li> <li><p>对于每个可见节点，为其找到适配的 CSSOM 规则并应用它们</p></li> <li><p>发射可见节点，连同其内容和计算的样式</p></li></ol> <p>请注意 visibility: hidden 与 display: none 是不一样的。前者隐藏元素，但元素仍占据着布局空间（即将其渲染成一个空框），而后者 (display: none) 将元素从渲染树中完全移除，元素既不可见，也不是布局的组成部分</p> <h2 id="_5-渲染树布局"><a href="#_5-渲染树布局" class="header-anchor">#</a> 5. 渲染树布局</h2> <p>布局阶段会从渲染树的根节点开始遍历，然后确定每个节点对象在页面上的确切大小与位置，布局阶段的输出是一个盒子模型，它会精确地捕获每个元素在屏幕内的确切位置与大小</p> <h3 id="_5-1-分层"><a href="#_5-1-分层" class="header-anchor">#</a> 5.1 分层</h3> <p>因为页面中有很多复杂的效果，如一些复杂的 3D 变换、页面滚动，或者使用 z-indexing 做 z 轴排序等，为了更加方便地实现这些效果，渲染引擎还需要为特定的节点生成专用的图层，并生成一棵对应的图层树</p> <ol><li><p>拥有层叠上下文属性的元素会被提升为单独的一层</p> <p><img src="/img/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="层叠上下文示意图"></p> <p>从图中可以看出，明确定位属性的元素、定义透明属性的元素、使用 CSS 滤镜的元素等，都拥有层叠上下文属性</p></li> <li><p>需要剪裁（clip）的地方也会被创建为图层
需要剪裁也就是说容器内容不足以显示页面内容，出现了滚动条，渲染引擎会为这部分单独创建一个层</p></li></ol> <h2 id="_6-渲染树绘制"><a href="#_6-渲染树绘制" class="header-anchor">#</a> 6. 渲染树绘制</h2> <p>在绘制阶段，遍历渲染树，调用渲染器的paint()方法在屏幕上显示其内容。渲染树的绘制工作是由浏览器的UI后端组件完成的。</p> <p>在完成图层树的构建之后，渲染引擎会对图层树中的每个图层进行绘制</p> <h3 id="_6-1-栅格化-raster"><a href="#_6-1-栅格化-raster" class="header-anchor">#</a> 6.1 栅格化(raster)</h3> <p>要明白栅格化，先要理解什么是图块和位图。</p> <p><strong>图块(tile)</strong>
图块是渲染进程即浏览器内核当中的合成线程将图层划分为大小512x512或者256x256的区块</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%A0%85%E6%A0%BC%E5%8C%96-1.png" alt="浏览器渲染栅格化"></p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%A0%85%E6%A0%BC%E5%8C%96-2.png" alt="浏览器渲染栅格化"></p> <p><strong>位图</strong>
位图是栅格化的过程：合成线程会按照视口附近的图块来优先生成位图，实际生成位图的操作是由栅格化来执行的，将图块转换为位图。</p> <h3 id="_6-2-合成和显示"><a href="#_6-2-合成和显示" class="header-anchor">#</a> 6.2 合成和显示</h3> <p>一旦所有图块都被光栅化，合成线程就会生成一个绘制图块的命令——“DrawQuad”，然后将该命令提交给浏览器进程</p> <p>浏览器进程里面有一个叫 viz 的组件，用来接收合成线程发过来的 DrawQuad 命令，然后根据 DrawQuad 命令，将其页面内容绘制到内存中，最后再将内存显示在屏幕上</p> <h2 id="_7-渲染流水线总结"><a href="#_7-渲染流水线总结" class="header-anchor">#</a> 7. 渲染流水线总结</h2> <p>从HTML到DOM、样式计算、布局、图层、绘制、光栅化、合成和显示。下面一张图是总结下这整个渲染流程</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B%E6%80%BB%E7%BB%93.png" alt="浏览器渲染进程总结"></p> <ol><li>渲染进程将HTML内容转换为能够读懂的<code>DOM树</code>结构。</li> <li>渲染引擎将CSS样式表转化为浏览器可以理解的<code>styleSheets</code>，计算出DOM节点的样式。</li> <li>创建<code>布局树</code>，并计算元素的布局信息。</li> <li>对布局树进行分层，并生成<code>分层树</code>。</li> <li>为每个图层生成<code>绘制列表</code>，并将其提交到合成线程。</li> <li>合成线程将图层分成<code>图块</code>，并在光栅化线程池中将图块转换成位图。</li> <li>合成线程发送绘制图块命令<code>DrawQuad</code>给浏览器进程。</li> <li>浏览器进程根据DrawQuad消息生成页面，并<code>显示</code>到显示器上。</li></ol> <h2 id="_8-回流与重绘"><a href="#_8-回流与重绘" class="header-anchor">#</a> 8. 回流与重绘</h2> <h3 id="_8-1-回流-重排-reflow"><a href="#_8-1-回流-重排-reflow" class="header-anchor">#</a> 8.1 回流/重排（Reflow）</h3> <p>意味着元件的几何尺寸变了，我们需要重新验证并计算Render Tree。是Render Tree的一部分或全部发生了变化。这就是Reflow，或是Layout</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%87%8D%E6%8E%92.png" alt="重排"></p> <p>从上图可以看出，如果你通过 JavaScript 或者 CSS 修改元素的几何位置属性，例如改变元素的宽度、高度等，那么浏览器会触发重新布局，解析之后的一系列子阶段，这个过程就叫重排。无疑，<strong>重排需要更新完整的渲染流水线，所以开销也是最大的。</strong></p> <h3 id="_8-2-常见引起回流-重排属性的方法"><a href="#_8-2-常见引起回流-重排属性的方法" class="header-anchor">#</a> 8.2 常见引起回流/重排属性的方法</h3> <ul><li>页面首次渲染</li> <li>浏览器窗口大小发生改变</li> <li>元素尺寸或位置发生改变</li> <li>元素内容变化（文字数量或图片大小等）</li> <li>元素字体大小变化</li> <li>添加或删除可见的DOM元素</li> <li>激活CSS伪类（如:hover）</li></ul> <p>具体内容如下</p> <ul><li>width/height</li> <li>margin/padding/border</li> <li>display/position/overflow</li> <li>clientWidth/clientHeight</li> <li>clientTop/clientLeft</li> <li>offsetWidth/offsetHeight</li> <li>offsetTop/offsetLeft</li> <li>scrollWidth/scrollHeight</li> <li>scrollTop/scrollLeft</li> <li>scrollIntoView()</li> <li>scrollTo()</li> <li>getComputedStyle()</li> <li>getBoundingClientRect()</li> <li>scrollIntoViewIfNeeded()</li></ul> <h3 id="_8-3-重绘-重绘-repaint"><a href="#_8-3-重绘-重绘-repaint" class="header-anchor">#</a> 8.3 重绘/重绘（Repaint）</h3> <p>当一个元素的外观发生改变，但没有改变布局，重新把元素外观绘制出来的过程，叫做重绘</p> <p><img src="/img/%E6%B5%8F%E8%A7%88%E5%99%A8%E9%87%8D%E7%BB%98.png" alt="重绘">
从图中可以看出，如果修改了元素的背景颜色，那么布局阶段将不会被执行，因为并没有引起几何位置的变换，所以就直接进入了绘制阶段，然后执行之后的一系列子阶段，这个过程就叫重绘。<strong>相较于重排操作，重绘省去了布局和分层阶段，所以执行效率会比重排操作要高一些。</strong></p> <p>常见引起重绘属性的方法</p> <ul><li>visibility</li> <li>color</li> <li>border-style/border-radius</li> <li>background/background-image/background-position/background-repeat/background-size</li> <li>text-decoration</li> <li>outline-color/outline/outline-style/outline-width</li> <li>box-shadow</li></ul> <h3 id="_8-4-回流与重绘的关系"><a href="#_8-4-回流与重绘的关系" class="header-anchor">#</a> 8.4 回流与重绘的关系</h3> <p>回流必定会引起重绘，而重绘不一定会引起回流。</p> <h3 id="_8-5-浏览器的渲染队列"><a href="#_8-5-浏览器的渲染队列" class="header-anchor">#</a> 8.5 浏览器的渲染队列</h3> <p>当我们修改了元素的几何属性，导致浏览器触发重排或重绘时。它会把该操作放进渲染队列，等到队列中的操作到了一定的数量或者到了一定的时间间隔时，浏览器就会批量执行这些操作</p> <p><strong>强制刷新队列</strong>
因为队列中，可能会有影响到这些值的操作，为了给我们最精确的值，浏览器会立即重排+重绘</p> <p>强制刷新队列的style样式请求：
<code>offsetTop</code>、<code>offsetLeft</code>、<code>offsetWidth</code>、<code>offsetHeight、</code> <code>scrollTop</code>、<code>scrollLeft</code>、<code>scrollWidth</code>、<code>scrollHeight</code> <code>clientTop</code>、<code>clientLeft</code>、<code>clientWidth</code>、<code>clientHeight</code> <code>getComputedStyle()</code>， 或者 IE的 <code>currentStyle</code></p> <p>我们在开发中，应该谨慎的使用这些style请求，注意上下文关系，避免一行代码一个重排，这对性能是个巨大的消耗</p> <h3 id="_8-6-优化策略"><a href="#_8-6-优化策略" class="header-anchor">#</a> 8.6 优化策略</h3> <h4 id="_8-6-1-分离读写操作"><a href="#_8-6-1-分离读写操作" class="header-anchor">#</a> 8.6.1 分离读写操作</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// bad 4次重排+重绘</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">'10px'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">'10px'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>offsetTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// good 一次重排</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">'10px'</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">'10px'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>offsetTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_8-6-2-样式集中改变"><a href="#_8-6-2-样式集中改变" class="header-anchor">#</a> 8.6.2 样式集中改变</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// bad</span>
<span class="token keyword">const</span> left <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> top <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>left <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>top <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// good</span>
el<span class="token punctuation">.</span>className <span class="token operator">+=</span> <span class="token string">'className'</span><span class="token punctuation">;</span>
<span class="token comment">// good</span>
el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">; left: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> left <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px; top: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> top <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_8-6-3-离线改变dom"><a href="#_8-6-3-离线改变dom" class="header-anchor">#</a> 8.6.3 离线改变dom</h4> <ul><li>隐藏要操作的dom</li></ul> <p>在要操作dom之前，通过display隐藏dom，当操作完成之后，才将元素的display属性为可见，因为不可见的元素不会触发重排和重绘</p> <ul><li>将原始元素拷贝到一个脱离文档的节点中，修改节点后，再替换原始的元素</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> clone <span class="token operator">=</span> ul<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">appendDataToElement</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
ul<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> ul<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_8-6-4-避免触发同步布局事件"><a href="#_8-6-4-避免触发同步布局事件" class="header-anchor">#</a> 8.6.4 避免触发同步布局事件</h4> <p>当我们访问元素的一些属性的时候，会导致浏览器强制清空队列，强制刷新队列，所以避免使用这些属性</p> <h4 id="_8-6-5-对于复杂动画效果-使用绝对定位让其脱离文档流"><a href="#_8-6-5-对于复杂动画效果-使用绝对定位让其脱离文档流" class="header-anchor">#</a> 8.6.5 对于复杂动画效果，使用绝对定位让其脱离文档流</h4> <p>对于复杂动画效果，由于会经常的引起回流重绘，因此，我们可以使用绝对定位，让它脱离文档流。否则会引起父元素以及后续元素频繁的回流</p> <h4 id="_8-6-6-使用transform替代position"><a href="#_8-6-6-使用transform替代position" class="header-anchor">#</a> 8.6.6 使用transform替代position</h4> <p>主线程需要做的任务如下：</p> <ul><li>运行Javascript</li> <li>计算HTML元素的CSS样式</li> <li>layout (relayout)</li> <li>将页面元素绘制成一张或多张位图</li> <li>将位图发送给合成线程</li></ul> <p>合成线程主要任务是：</p> <ul><li>利用GPU将位图绘制到屏幕上</li> <li>让主线程将可见的或即将可见的位图发给自己</li> <li>计算哪部分页面是可见的</li> <li>计算哪部分页面是即将可见的（当你的滚动页面的时候）</li> <li>在你滚动时移动部分页面</li></ul> <p>当用户滚动一个页面时，合成线程会让主线程提供最新的可见部分的页面位图。然而主线程不能及时的响应。这时合成线程不会等待，它会绘制已有的页面位图。对于没有的部分则绘制白屏。</p> <ul><li>transform 属性不会影响元素的布局或样式，只是改变元素的视觉呈现，例如位置、大小、旋转角度等。由于它操作的是 合成层（compositing layer） ，完全由 GPU 负责计算和渲染，因此不会触发重排或重绘。</li> <li>transform 会使用 GPU 硬件加速，性能更好；position + top/left 会触发大量的重绘和回流，性能影响较大</li> <li>硬件加速的工作原理是创建一个新的复合图层，然后使用合成线程进行渲染</li> <li>使用GPU可以优化动画效果，但是不要滥用，会有内存问题</li> <li>理解强制触发硬件加速的 transform 技巧，使用对GPU友好的CSS属性</li> <li>使用 transform 和 opacity，实现高性能动画，减少重排和重绘。借助 GPU 渲染的合成层优化动画效果。</li></ul> <h2 id="_9-渲染性能监控"><a href="#_9-渲染性能监控" class="header-anchor">#</a> 9. 渲染性能监控</h2> <h3 id="_9-1-使用performance-api"><a href="#_9-1-使用performance-api" class="header-anchor">#</a> 9.1 使用Performance API</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 监控长任务</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>duration <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'长任务:'</span><span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'longtask'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监控首屏渲染时间</span>
<span class="token keyword">function</span> <span class="token function">measureFirstPaint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entry<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entry<span class="token punctuation">.</span>startTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">entryTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'paint'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_9-2-使用lighthouse进行性能分析"><a href="#_9-2-使用lighthouse进行性能分析" class="header-anchor">#</a> 9.2 使用Lighthouse进行性能分析</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 在开发环境中使用Lighthouse API</span>
<span class="token keyword">const</span> lighthouse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lighthouse'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chromeLauncher <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chrome-launcher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runLighthouse</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> chrome <span class="token operator">=</span> <span class="token keyword">await</span> chromeLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">chromeFlags</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'--headless'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">logLevel</span><span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token literal-property property">onlyCategories</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'performance'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> runnerResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">lighthouse</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 输出性能报告</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'性能评分:'</span><span class="token punctuation">,</span> runnerResult<span class="token punctuation">.</span>lhr<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">await</span> chrome<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h3> <p><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-cn" target="_blank" rel="noopener noreferrer">渲染树构建、布局及绘制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5a9923e9518825558251ce15" target="_blank" rel="noopener noreferrer">浏览器的回流与重绘 (Reflow &amp; Repaint)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://segmentfault.com/a/1190000018357727" target="_blank" rel="noopener noreferrer">你真的了解回流和重绘吗<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/xiaohuochai/p/9136213.html" target="_blank" rel="noopener noreferrer">前端性能优化之浏览器渲染优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developers.google.com/web/fundamentals/performance/rendering" target="_blank" rel="noopener noreferrer">Google Web Fundamentals - Rendering Performance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/16/2025, 5:51:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/network/0-browser/05-浏览器缓存.html" class="prev">
        浏览器缓存
      </a></span> <span class="next"><a href="/network/1-network/01-TCP与UDP协议.html">
        TCP与UDP协议
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.fdbd3a7d.js" defer></script><script src="/assets/js/2.c135791f.js" defer></script><script src="/assets/js/1.ef243348.js" defer></script><script src="/assets/js/41.0252e8a3.js" defer></script>
  </body>
</html>
