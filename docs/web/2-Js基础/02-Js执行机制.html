<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript执行机制详解</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="深入理解JavaScript执行机制，包括作用域、变量提升、执行上下文、作用域链和闭包等核心概念">
    <meta name="keywords" content="JavaScript执行机制,Js作用域,变量提升,执行上下文,作用域链,闭包,JavaScript,前端">
    <meta name="author" content="liam">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.e2f44ae9.css" as="style"><link rel="preload" href="/assets/js/app.fdbd3a7d.js" as="script"><link rel="preload" href="/assets/js/2.c135791f.js" as="script"><link rel="preload" href="/assets/js/1.ef243348.js" as="script"><link rel="preload" href="/assets/js/69.5cb10b3a.js" as="script"><link rel="prefetch" href="/assets/js/10.fac04ee2.js"><link rel="prefetch" href="/assets/js/11.df95b6d6.js"><link rel="prefetch" href="/assets/js/12.d322d79f.js"><link rel="prefetch" href="/assets/js/13.d461d101.js"><link rel="prefetch" href="/assets/js/14.eee8ad98.js"><link rel="prefetch" href="/assets/js/15.2da99dce.js"><link rel="prefetch" href="/assets/js/16.8066bbcc.js"><link rel="prefetch" href="/assets/js/17.0f456d45.js"><link rel="prefetch" href="/assets/js/18.87a15af9.js"><link rel="prefetch" href="/assets/js/19.8bf1456f.js"><link rel="prefetch" href="/assets/js/20.8e68410b.js"><link rel="prefetch" href="/assets/js/21.dbe112a9.js"><link rel="prefetch" href="/assets/js/22.f152b048.js"><link rel="prefetch" href="/assets/js/23.5f51756a.js"><link rel="prefetch" href="/assets/js/24.eafe48b1.js"><link rel="prefetch" href="/assets/js/25.02eda376.js"><link rel="prefetch" href="/assets/js/26.3d00d40b.js"><link rel="prefetch" href="/assets/js/27.98f181f5.js"><link rel="prefetch" href="/assets/js/28.ad631fc4.js"><link rel="prefetch" href="/assets/js/29.b9dd2f73.js"><link rel="prefetch" href="/assets/js/3.2be8686e.js"><link rel="prefetch" href="/assets/js/30.ac2f9ca3.js"><link rel="prefetch" href="/assets/js/31.7b0dc993.js"><link rel="prefetch" href="/assets/js/32.36cfbdda.js"><link rel="prefetch" href="/assets/js/33.de52c7e1.js"><link rel="prefetch" href="/assets/js/34.e3acfb01.js"><link rel="prefetch" href="/assets/js/35.fa488a03.js"><link rel="prefetch" href="/assets/js/36.5ec5b495.js"><link rel="prefetch" href="/assets/js/37.defa9fca.js"><link rel="prefetch" href="/assets/js/38.c10c335d.js"><link rel="prefetch" href="/assets/js/39.b94d4635.js"><link rel="prefetch" href="/assets/js/4.9be6b6a0.js"><link rel="prefetch" href="/assets/js/40.c80d1540.js"><link rel="prefetch" href="/assets/js/41.0252e8a3.js"><link rel="prefetch" href="/assets/js/42.bafa2252.js"><link rel="prefetch" href="/assets/js/43.a92a8c38.js"><link rel="prefetch" href="/assets/js/44.036b9bbd.js"><link rel="prefetch" href="/assets/js/45.932a99da.js"><link rel="prefetch" href="/assets/js/46.f09b813d.js"><link rel="prefetch" href="/assets/js/47.1480826c.js"><link rel="prefetch" href="/assets/js/48.13966581.js"><link rel="prefetch" href="/assets/js/49.4891ceb5.js"><link rel="prefetch" href="/assets/js/5.740bd581.js"><link rel="prefetch" href="/assets/js/50.f013af64.js"><link rel="prefetch" href="/assets/js/51.e18a236f.js"><link rel="prefetch" href="/assets/js/52.119fc6e0.js"><link rel="prefetch" href="/assets/js/53.b0675f90.js"><link rel="prefetch" href="/assets/js/54.0e15abb1.js"><link rel="prefetch" href="/assets/js/55.2af4c93e.js"><link rel="prefetch" href="/assets/js/56.e753164e.js"><link rel="prefetch" href="/assets/js/57.fba77abc.js"><link rel="prefetch" href="/assets/js/58.f8cf67e3.js"><link rel="prefetch" href="/assets/js/59.7131c32e.js"><link rel="prefetch" href="/assets/js/6.b59cd7d8.js"><link rel="prefetch" href="/assets/js/60.8581d2d7.js"><link rel="prefetch" href="/assets/js/61.20226f1d.js"><link rel="prefetch" href="/assets/js/62.254d9ae8.js"><link rel="prefetch" href="/assets/js/63.45b87153.js"><link rel="prefetch" href="/assets/js/64.c71a7f6f.js"><link rel="prefetch" href="/assets/js/65.d5fead4d.js"><link rel="prefetch" href="/assets/js/66.414ea1ae.js"><link rel="prefetch" href="/assets/js/67.21230f8e.js"><link rel="prefetch" href="/assets/js/68.02a17eb1.js"><link rel="prefetch" href="/assets/js/7.f54d7af6.js"><link rel="prefetch" href="/assets/js/70.c9fdf696.js"><link rel="prefetch" href="/assets/js/71.8064a150.js"><link rel="prefetch" href="/assets/js/72.4ab06319.js"><link rel="prefetch" href="/assets/js/73.a6dd0d8f.js"><link rel="prefetch" href="/assets/js/74.1f24a32f.js"><link rel="prefetch" href="/assets/js/75.19e4505d.js"><link rel="prefetch" href="/assets/js/76.ab6c86a0.js"><link rel="prefetch" href="/assets/js/77.1ce9dc61.js"><link rel="prefetch" href="/assets/js/78.e0ab9e4e.js"><link rel="prefetch" href="/assets/js/79.041b24ad.js"><link rel="prefetch" href="/assets/js/80.7e85dcac.js"><link rel="prefetch" href="/assets/js/81.c070cff6.js"><link rel="prefetch" href="/assets/js/82.05206f1b.js"><link rel="prefetch" href="/assets/js/83.58015a46.js"><link rel="prefetch" href="/assets/js/84.d65cc23d.js"><link rel="prefetch" href="/assets/js/85.aa8c60c9.js"><link rel="prefetch" href="/assets/js/86.670a93b3.js"><link rel="prefetch" href="/assets/js/87.4b8c6571.js"><link rel="prefetch" href="/assets/js/88.d0e60af8.js"><link rel="prefetch" href="/assets/js/89.fd1d2e29.js"><link rel="prefetch" href="/assets/js/90.28d64579.js"><link rel="prefetch" href="/assets/js/91.88717d89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.92fa0d62.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2f44ae9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header-logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/frame/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/huoyuhao/huoyuhao.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/frame/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/huoyuhao/huoyuhao.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Js基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/2-Js基础/00-Js基础总结.html" class="sidebar-link">Js基础总结</a></li><li><a href="/web/2-Js基础/01-Js基础数据类型.html" class="sidebar-link">Js基础数据类型</a></li><li><a href="/web/2-Js基础/01-Js数组.html" class="sidebar-link">Js数组</a></li><li><a href="/web/2-Js基础/01-Js正则表达式.html" class="sidebar-link">Js正则表达式</a></li><li><a href="/web/2-Js基础/02-Js执行机制.html" class="active sidebar-link">Js执行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_1-作用域" class="sidebar-link">1. 作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_1-1-什么是作用域" class="sidebar-link">1.1 什么是作用域</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_1-2-javascript作用域类型" class="sidebar-link">1.2 JavaScript作用域类型</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_1-3-全局作用域" class="sidebar-link">1.3 全局作用域</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_1-4-函数作用域" class="sidebar-link">1.4 函数作用域</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_1-5-块级作用域" class="sidebar-link">1.5 块级作用域</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_1-6-作用域链" class="sidebar-link">1.6 作用域链</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_2-变量提升" class="sidebar-link">2. 变量提升</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_2-1-什么是变量提升" class="sidebar-link">2.1 什么是变量提升</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_2-2-变量声明与赋值" class="sidebar-link">2.2 变量声明与赋值</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_2-3-函数提升" class="sidebar-link">2.3 函数提升</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_2-4-let-const-与变量提升" class="sidebar-link">2.4 let/const 与变量提升</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_2-5-变量提升的最佳实践" class="sidebar-link">2.5 变量提升的最佳实践</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_3-执行上下文" class="sidebar-link">3. 执行上下文</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_3-1-什么是执行上下文" class="sidebar-link">3.1 什么是执行上下文</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_3-2-执行上下文的组成部分" class="sidebar-link">3.2 执行上下文的组成部分</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_3-3-执行上下文的创建过程" class="sidebar-link">3.3 执行上下文的创建过程</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_3-4-执行上下文示例" class="sidebar-link">3.4 执行上下文示例</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_3-5-执行上下文栈" class="sidebar-link">3.5 执行上下文栈</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_4-执行流程" class="sidebar-link">4. 执行流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_4-1-变量和函数声明" class="sidebar-link">4.1 变量和函数声明</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_4-2-编译阶段" class="sidebar-link">4.2 编译阶段</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_4-3-执行阶段" class="sidebar-link">4.3 执行阶段</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_4-4-代码中出现相同的变量或者函数" class="sidebar-link">4.4 代码中出现相同的变量或者函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_5-作用域链" class="sidebar-link">5. 作用域链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_5-1-什么是作用域链" class="sidebar-link">5.1 什么是作用域链</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_5-2-作用域链的查找机制" class="sidebar-link">5.2 作用域链的查找机制</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_5-3-作用域链的构建过程" class="sidebar-link">5.3 作用域链的构建过程</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_5-4-延长作用域链" class="sidebar-link">5.4 延长作用域链</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_6-变量环境对象" class="sidebar-link">6. 变量环境对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_6-1-什么是变量环境对象" class="sidebar-link">6.1 什么是变量环境对象</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_6-2-变量环境对象的创建过程" class="sidebar-link">6.2 变量环境对象的创建过程</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_6-3-变量环境对象与词法环境的区别" class="sidebar-link">6.3 变量环境对象与词法环境的区别</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_6-4-变量环境对象的实际应用" class="sidebar-link">6.4 变量环境对象的实际应用</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-闭包" class="sidebar-link">7. 闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-1-什么是闭包" class="sidebar-link">7.1 什么是闭包</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-2-闭包的形成条件" class="sidebar-link">7.2 闭包的形成条件</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-3-闭包的特点" class="sidebar-link">7.3 闭包的特点</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-4-闭包的应用场景" class="sidebar-link">7.4 闭包的应用场景</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-5-闭包的注意事项" class="sidebar-link">7.5 闭包的注意事项</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-6-闭包常见问题及解决方案" class="sidebar-link">7.6 闭包常见问题及解决方案</a></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#_7-7-闭包题目" class="sidebar-link">7.7 闭包题目</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/2-Js基础/02-Js执行机制.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/web/2-Js基础/03-Js中This.html" class="sidebar-link">Js中This</a></li><li><a href="/web/2-Js基础/03-Js中的call方法.html" class="sidebar-link">Js中的call方法</a></li><li><a href="/web/2-Js基础/03-Js中的new操作符.html" class="sidebar-link">Js中的new操作符</a></li><li><a href="/web/2-Js基础/04-Js原型链.html" class="sidebar-link">Js原型链</a></li><li><a href="/web/2-Js基础/05-Js防抖节流.html" class="sidebar-link">Js防抖节流</a></li><li><a href="/web/2-Js基础/06-Js深拷贝.html" class="sidebar-link">Js深拷贝</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DOM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript执行机制详解"><a href="#javascript执行机制详解" class="header-anchor">#</a> JavaScript执行机制详解</h1> <h2 id="_1-作用域"><a href="#_1-作用域" class="header-anchor">#</a> 1. 作用域</h2> <h3 id="_1-1-什么是作用域"><a href="#_1-1-什么是作用域" class="header-anchor">#</a> 1.1 什么是作用域</h3> <blockquote><p>作用域是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗地理解，作用域就是变量与函数的可访问范围，即作用域控制着变量和函数的可见性和生命周期。</p></blockquote> <p>作用域是JavaScript中一个重要的概念，它决定了变量和函数的可访问范围。主要特点包括：</p> <ol><li><strong>变量隔离</strong>：作用域最大的用处就是隔离变量，不同作用域下同名变量不会有冲突</li> <li><strong>生命周期控制</strong>：作用域决定了变量的生命周期，影响内存管理</li> <li><strong>访问权限控制</strong>：控制变量和函数的可见性</li></ol> <h3 id="_1-2-javascript作用域类型"><a href="#_1-2-javascript作用域类型" class="header-anchor">#</a> 1.2 JavaScript作用域类型</h3> <p>JavaScript中有以下几种作用域类型：</p> <ol><li><strong>全局作用域</strong>：代码中最外层的范围，在整个程序中都可以访问</li> <li><strong>函数作用域</strong>：在函数内部定义的变量，只能在该函数内部访问</li> <li><strong>块级作用域</strong>：ES6引入，使用<code>let</code>和<code>const</code>在代码块（<code>{}</code>）内定义的变量，只能在该代码块内访问</li></ol> <p>在ES6之前，JavaScript只有全局作用域和函数作用域。ES6的<code>let</code>和<code>const</code>关键字为我们提供了块级作用域的支持。</p> <h3 id="_1-3-全局作用域"><a href="#_1-3-全局作用域" class="header-anchor">#</a> 1.3 全局作用域</h3> <p>全局作用域是代码中最外层的范围，在整个程序中都可以访问。以下几种情况会创建全局变量：</p> <ol><li>在最外层函数外部定义的变量</li> <li>在最外层函数内部定义但未使用<code>var</code>、<code>let</code>或<code>const</code>声明的变量</li> <li>所有<code>window</code>对象的属性</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 全局变量</span>
<span class="token keyword">var</span> globalVar <span class="token operator">=</span> <span class="token string">'I am global'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 未声明直接赋值，也成为了全局变量</span>
  implicitlyGlobal <span class="token operator">=</span> <span class="token string">'I am implicitly global'</span><span class="token punctuation">;</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问全局变量</span>
<span class="token punctuation">}</span>

<span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>implicitlyGlobal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问</span>

<span class="token comment">// window对象的属性也是全局可访问的</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_1-4-函数作用域"><a href="#_1-4-函数作用域" class="header-anchor">#</a> 1.4 函数作用域</h3> <p>函数作用域是指在函数内部定义的变量，只能在该函数内部访问，对外部是不可见的。</p> <p>注意：在函数内部定义变量时，如果不用<code>var</code>、<code>let</code>或<code>const</code>声明，而是直接赋值，那么会创建全局变量。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> outerVar <span class="token operator">=</span> <span class="token string">'I am outer'</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> innerVar <span class="token operator">=</span> <span class="token string">'I am inner'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>outerVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问外部函数的变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>innerVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问自己的变量</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>outerVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问自己的变量</span>
  <span class="token comment">// console.log(innerVar); // 错误：无法访问内部函数的变量</span>
<span class="token punctuation">}</span>

<span class="token function">outerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// console.log(outerVar); // 错误：无法访问函数内部的变量</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_1-5-块级作用域"><a href="#_1-5-块级作用域" class="header-anchor">#</a> 1.5 块级作用域</h3> <p>ES6引入了块级作用域，使用<code>let</code>和<code>const</code>在代码块（<code>{}</code>）内定义的变量，只能在该代码块内访问。</p> <p>块级作用域的特点：</p> <ol><li><strong>作用域范围</strong>：在函数内部或代码块（由一对花括号包裹）内部创建</li> <li><strong>暂时性死区</strong>：在代码块内，<code>let</code>/<code>const</code>声明的变量在声明之前是不可访问的</li> <li><strong>不允许重复声明</strong>：在同一作用域内，不允许用<code>let</code>/<code>const</code>重复声明同名变量</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> blockVar <span class="token operator">=</span> <span class="token string">'I am block scoped'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> blockConst <span class="token operator">=</span> <span class="token string">'I am also block scoped'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blockVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blockConst<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// console.log(blockVar); // 错误：无法访问块级作用域的变量</span>
  <span class="token comment">// console.log(blockConst); // 错误：无法访问块级作用域的变量</span>
<span class="token punctuation">}</span>

<span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// for循环中的块级作用域</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 0, 1, 2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用var的情况</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 3, 3, 3</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// eslint-disable-next-line</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 内部作用域，会先去查找是有已有变量b的声明，有就直接赋值20，确实有了呀。发现了具名函数 function b(){}，拿此b做赋值；</span>
  <span class="token comment">// IIFE的函数无法进行赋值（内部机制，类似const定义的常量），所以无效。</span>
  <span class="token comment">// （这里说的“内部机制”，想搞清楚，需要去查阅一些资料，弄明白IIFE在JS引擎的工作方式，堆栈存储IIFE的方式等）</span>
  b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function b]</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10，不是20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_1-6-作用域链"><a href="#_1-6-作用域链" class="header-anchor">#</a> 1.6 作用域链</h3> <p>作用域是分层的，内层作用域可以访问外层作用域的变量，反之则不行。这种层级关系形成了作用域链。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> globalVar <span class="token operator">=</span> <span class="token string">'I am global'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> outerVar <span class="token operator">=</span> <span class="token string">'I am outer'</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> innerVar <span class="token operator">=</span> <span class="token string">'I am inner'</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 可以访问所有层级的变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>innerVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问自己的变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>outerVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问外层函数的变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalVar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问全局变量</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// console.log(innerVar); // 错误：无法访问内层函数的变量</span>
<span class="token punctuation">}</span>

<span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_2-变量提升"><a href="#_2-变量提升" class="header-anchor">#</a> 2. 变量提升</h2> <h3 id="_2-1-什么是变量提升"><a href="#_2-1-什么是变量提升" class="header-anchor">#</a> 2.1 什么是变量提升</h3> <p>变量提升（Hoisting）是JavaScript中一个重要的概念，它指的是JavaScript引擎在代码执行前会先进行一次扫描，将所有变量声明（var）和函数声明提升到其作用域的顶部。这意味着你可以在变量声明之前访问它，而不会报错。</p> <p>注意：只有声明会被提升，赋值不会被提升。</p> <h3 id="_2-2-变量声明与赋值"><a href="#_2-2-变量声明与赋值" class="header-anchor">#</a> 2.2 变量声明与赋值</h3> <p><code>var a = 2;</code> 这个语句其实包含两个过程：</p> <ol><li><code>var a;</code> // 变量声明</li> <li><code>a = 2;</code> // 变量赋值</li></ol> <p>变量提升只提升声明部分，不提升赋值部分：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// eslint-disable-next-line no-var</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'liam'</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token comment">// var name; // 声明部分</span>
<span class="token comment">// name = 'liam'; // 赋值部分</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-3-函数提升"><a href="#_2-3-函数提升" class="header-anchor">#</a> 2.3 函数提升</h3> <p>函数声明会被提升，但函数表达式不会被提升：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 函数声明会被提升</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function: fn]</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 函数表达式不会被提升</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token keyword">var</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>函数声明的提升优先级高于变量声明：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'liam'</span>
<span class="token keyword">function</span> <span class="token function">showName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'函数showName被执行'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 等同于</span>

<span class="token comment">/*
* 变量提升部分
*/</span>
<span class="token comment">// 把变量 name 提升到开头，</span>
<span class="token comment">// 同时给 name 赋值为undefined</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token keyword">undefined</span>
<span class="token comment">// 把函数showName提升到开头</span>
<span class="token keyword">function</span> <span class="token function">showName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'函数showName被执行'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
* 可执行代码部分
*/</span>
<span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token comment">// 去掉var声明部分，保留赋值语句</span>
name <span class="token operator">=</span> <span class="token string">'liam'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>当有多个同名变量声明的时候，函数声明会覆盖其他的声明。如果有多个函数声明，则是由最后的一个函数声明覆盖之前所有的声明</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 函数</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 变量 1</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 变量 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-4-let-const-与变量提升"><a href="#_2-4-let-const-与变量提升" class="header-anchor">#</a> 2.4 let/const 与变量提升</h3> <p><code>let</code>/<code>const</code> 声明的变量也会被提升，但它们不会被初始化，因此在声明之前访问它们会导致<code>ReferenceError</code>。这种现象被称为暂时性死区（Temporal Dead Zone）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: Cannot access 'a' before initialization</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined (var声明被提升但未赋值)</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: Cannot access 'a' before initialization</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-5-变量提升的最佳实践"><a href="#_2-5-变量提升的最佳实践" class="header-anchor">#</a> 2.5 变量提升的最佳实践</h3> <p>为了避免变量提升带来的问题，建议：</p> <ol><li>使用<code>let</code>和<code>const</code>替代<code>var</code></li> <li>在使用变量之前先声明变量</li> <li>将变量声明放在函数或作用域的顶部</li> <li>避免在声明之前使用变量</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 推荐的写法</span>
<span class="token keyword">function</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 在使用前声明</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
  
  <span class="token comment">// 函数声明也放在顶部</span>
  <span class="token keyword">function</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="_3-执行上下文"><a href="#_3-执行上下文" class="header-anchor">#</a> 3. 执行上下文</h2> <h3 id="_3-1-什么是执行上下文"><a href="#_3-1-什么是执行上下文" class="header-anchor">#</a> 3.1 什么是执行上下文</h3> <p>执行上下文（Execution Context）是JavaScript引擎在执行代码时创建的一个环境，它定义了变量或函数有权访问的其他数据，决定了它们各自的行为。</p> <p>每当JavaScript代码执行时，都会创建一个执行上下文。执行上下文主要分为三种类型：</p> <ol><li><strong>全局执行上下文</strong>：这是默认的执行上下文，在代码开始执行时创建</li> <li><strong>函数执行上下文</strong>：每当一个函数被调用时，都会为该函数创建一个新的执行上下文</li> <li><strong>Eval执行上下文</strong>：在eval函数内部运行的代码会产生Eval执行上下文（不推荐使用eval）</li></ol> <h3 id="_3-2-执行上下文的组成部分"><a href="#_3-2-执行上下文的组成部分" class="header-anchor">#</a> 3.2 执行上下文的组成部分</h3> <p>执行上下文主要由以下三个部分组成：</p> <ol><li><strong>变量环境（Variable Environment）</strong>：存储通过var声明的变量和函数声明</li> <li><strong>词法环境（Lexical Environment）</strong>：存储通过let和const声明的变量</li> <li><strong>this绑定</strong>：确定this关键字的值</li></ol> <h3 id="_3-3-执行上下文的创建过程"><a href="#_3-3-执行上下文的创建过程" class="header-anchor">#</a> 3.3 执行上下文的创建过程</h3> <p>执行上下文的创建可以分为两个阶段：</p> <h4 id="_3-3-1-创建阶段"><a href="#_3-3-1-创建阶段" class="header-anchor">#</a> 3.3.1 创建阶段</h4> <p>在创建阶段，JavaScript引擎会执行以下操作：</p> <ol><li>确定this的值</li> <li>创建词法环境</li> <li>创建变量环境</li> <li>进行变量提升</li></ol> <h4 id="_3-3-2-执行阶段"><a href="#_3-3-2-执行阶段" class="header-anchor">#</a> 3.3.2 执行阶段</h4> <p>在执行阶段，JavaScript引擎会逐行执行代码，并完成变量赋值等操作。</p> <h3 id="_3-4-执行上下文示例"><a href="#_3-4-执行上下文示例" class="header-anchor">#</a> 3.4 执行上下文示例</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10 20 30</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>在这个例子中，会创建以下执行上下文：</p> <ol><li><strong>全局执行上下文</strong>：包含变量x</li> <li><strong>outer函数执行上下文</strong>：包含变量y</li> <li><strong>inner函数执行上下文</strong>：包含变量z</li></ol> <p>当代码执行时，JavaScript引擎会维护一个执行上下文栈（Execution Context Stack），用于管理所有执行上下文。</p> <h3 id="_3-5-执行上下文栈"><a href="#_3-5-执行上下文栈" class="header-anchor">#</a> 3.5 执行上下文栈</h3> <p>执行上下文栈（Execution Context Stack），也称为调用栈（Call Stack），是一种后进先出（LIFO）的数据结构，用于存储代码执行期间创建的所有执行上下文。</p> <p>执行上下文栈的工作过程如下：</p> <ol><li>JavaScript引擎首先创建全局执行上下文并将其压入栈底</li> <li>当函数被调用时，会为该函数创建一个新的执行上下文并压入栈顶</li> <li>函数执行完毕后，其对应的执行上下文会从栈中弹出</li> <li>当栈中所有的执行上下文都被弹出后，程序执行结束</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">third</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">third</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'third'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>执行上下文栈的变化过程：</p> <ol><li>创建全局执行上下文并压入栈</li> <li>调用first()，创建first执行上下文并压入栈</li> <li>first()调用second()，创建second执行上下文并压入栈</li> <li>second()调用third()，创建third执行上下文并压入栈</li> <li>third()执行完毕，third执行上下文出栈</li> <li>second()执行完毕，second执行上下文出栈</li> <li>first()执行完毕，first执行上下文出栈</li> <li>全局执行上下文出栈，程序结束</li></ol> <p>输出结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>first
second
third
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_4-执行流程"><a href="#_4-执行流程" class="header-anchor">#</a> 4. 执行流程</h2> <h3 id="_4-1-变量和函数声明"><a href="#_4-1-变量和函数声明" class="header-anchor">#</a> 4.1 变量和函数声明</h3> <p>实际上变量和函数声明在代码里的位置是不会改变的，而且是在编译阶段被 JavaScript 引擎放入内存中</p> <p>一段 JavaScript 代码在执行之前需要被 JavaScript 引擎编译，编译完成之后，才会进入执行阶段。</p> <h3 id="_4-2-编译阶段"><a href="#_4-2-编译阶段" class="header-anchor">#</a> 4.2 编译阶段</h3> <p><img src="/img/Js%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6-1.png" alt="Js执行机制"></p> <p>经过编译后，会生成两部分内容：<strong>执行上下文（Execution context）和可执行代码。</strong></p> <p><strong>执行上下文是 JavaScript 执行一段代码时的运行环境</strong>，比如调用一个函数，就会进入这个函数的执行上下文，确定该函数在执行期间用到的诸如 this、变量、对象以及函数等。</p> <p>在执行上下文中存在一个<strong>变量环境的对象（Viriable Environment）</strong>，该对象中保存了变量提升的内容，比如上面代码中的变量 myame 和函数 showName</p> <p>结合下面这段代码来分析下是如何生成变量环境对象的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// eslint-disable-next-line</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'liam'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">showName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'函数showName被执行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>第 1 行和第 2 行，由于这两行代码不是声明操作，所以 JavaScript 引擎不会做任何处理；</li> <li>第 3 行，由于这行是经过 var 声明的，因此 JavaScript 引擎将在环境对象中创建一个名为 name 的属性，并使用 undefined 对其初始化；</li> <li>第 4 行，JavaScript 引擎发现了一个通过 function 定义的函数，所以它将函数定义存储到堆 (HEAP）中，并在环境对象中创建一个 showName 的属性，然后将该属性值指向堆中函数的位置。</li></ul> <p>这样就生成了变量环境对象。接下来 JavaScript 引擎会把声明以外的代码编译为字节码</p> <h3 id="_4-3-执行阶段"><a href="#_4-3-执行阶段" class="header-anchor">#</a> 4.3 执行阶段</h3> <p>JavaScript 引擎开始执行“可执行代码”，按照顺序一行一行地执行。下面我们就来一行一行分析下这个执行过程：</p> <ul><li>当执行到 showName 函数时，JavaScript 引擎便开始在变量环境对象中查找该函数，由于变量环境对象中存在该函数的引用，所以 JavaScript 引擎便开始执行该函数，并输出“函数 showName 被执行”结果。</li> <li>接下来打印“name”信息，JavaScript 引擎继续在变量环境对象中查找该对象，由于变量环境存在 name 变量，并且其值为 undefined，所以这时候就输出 undefined。</li> <li>接下来执行第 3 行，把“liam”赋给 name 变量，赋值后变量环境中的 name 属性值改变为“liam”</li></ul> <h3 id="_4-4-代码中出现相同的变量或者函数"><a href="#_4-4-代码中出现相同的变量或者函数" class="header-anchor">#</a> 4.4 代码中出现相同的变量或者函数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> <span class="token function-variable function">showName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">showName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//编译阶段:</span>
<span class="token keyword">var</span> showName
<span class="token keyword">function</span> <span class="token function">showName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">//执行阶段:</span>
<span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 输出1</span>
<span class="token function-variable function">showName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token comment">// 如果后面再有showName执行的话，就输出2因为这时候函数引用已经变了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>注意：<strong>一段代码如果定义了两个相同名字的函数，那么最终生效的是最后一个函数</strong></p> <h2 id="_5-作用域链"><a href="#_5-作用域链" class="header-anchor">#</a> 5. 作用域链</h2> <h3 id="_5-1-什么是作用域链"><a href="#_5-1-什么是作用域链" class="header-anchor">#</a> 5.1 什么是作用域链</h3> <p>作用域链是由当前环境与上层环境的一系列变量对象组成的，它保证了当前执行环境对符合访问权限的变量和函数的有序访问。</p> <p>简单来说，作用域链就是查找变量和函数时的一条路径，这条路径从当前作用域开始，逐级向上查找，直到找到目标变量或函数，或者到达全局作用域。</p> <h3 id="_5-2-作用域链的查找机制"><a href="#_5-2-作用域链的查找机制" class="header-anchor">#</a> 5.2 作用域链的查找机制</h3> <p>当代码需要访问一个变量时，JavaScript引擎会按照以下顺序查找：</p> <ol><li>在当前作用域中查找</li> <li>如果没找到，到上层作用域中查找</li> <li>重复步骤2，直到找到变量或到达全局作用域</li> <li>如果在全局作用域也没找到，则抛出ReferenceError</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// eslint-disable-next-line</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">show</span> <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// eslint-disable-next-line</span>
  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">20</span>
  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10，而不是20</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">show</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>在上面的例子中，<code>fn</code>函数中的变量<code>x</code>是在创建<code>fn</code>函数的作用域（全局作用域）中查找的，而不是在调用<code>fn</code>函数的作用域中查找。这体现了作用域链的一个重要特性：<strong>变量的查找是在函数定义时确定的，而不是在函数调用时确定的</strong>。</p> <h3 id="_5-3-作用域链的构建过程"><a href="#_5-3-作用域链的构建过程" class="header-anchor">#</a> 5.3 作用域链的构建过程</h3> <p>作用域链的构建遵循以下规则：</p> <ol><li>函数内部可以访问函数外部的变量</li> <li>内层函数可以访问外层函数的变量</li> <li>外层函数无法访问内层函数的变量</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// eslint-disable-next-line</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token comment">// eslint-disable-next-line</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">200</span>
<span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// eslint-disable-next-line</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">20</span>
  <span class="token keyword">function</span> <span class="token function">bar</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 30</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// eslint-disable-next-line</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar()</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在这个例子中，作用域链的构建过程如下：</p> <ol><li><code>bar</code>函数可以访问自己的作用域</li> <li><code>bar</code>函数可以访问外层<code>fn</code>函数的作用域</li> <li><code>fn</code>函数可以访问全局作用域</li></ol> <p>因此，<code>bar</code>函数可以访问到全局变量<code>a</code>和<code>fn</code>函数中的变量<code>b</code>。</p> <h3 id="_5-4-延长作用域链"><a href="#_5-4-延长作用域链" class="header-anchor">#</a> 5.4 延长作用域链</h3> <p>某些语句可以在作用域链的前端临时增加一个变量对象，该变量对象会在代码执行后被移除。有两种情况下会发生这种现象：</p> <ol><li><strong>try-catch语句中的catch块</strong>：会创建一个新的变量对象，其中包含被抛出的错误对象的声明</li> <li><strong>with语句</strong>：会将指定对象添加到作用域链中</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// try-catch示例</span>
<span class="token keyword">var</span> errorMessage <span class="token operator">=</span> <span class="token string">'Global error'</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Local error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: Error: Local error</span>
  <span class="token comment">// 在catch块中，errorMessage指向错误对象，而不是全局变量</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: Global error</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// with语句示例</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'JavaScript'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">'ES6'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">with</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: JavaScript</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: ES6</span>
  <span class="token comment">// 在with块中，可以直接访问obj的属性</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注意：由于<code>with</code>语句会影响性能并使代码难以优化，现代JavaScript开发中不推荐使用。</p> <h2 id="_6-变量环境对象"><a href="#_6-变量环境对象" class="header-anchor">#</a> 6. 变量环境对象</h2> <h3 id="_6-1-什么是变量环境对象"><a href="#_6-1-什么是变量环境对象" class="header-anchor">#</a> 6.1 什么是变量环境对象</h3> <p>变量环境对象（Variable Environment Object）是执行上下文的一个组成部分，用于存储通过<code>var</code>声明的变量和函数声明。它是词法环境（Lexical Environment）的一个组成部分，在ES5及之前的版本中，它是存储变量的主要场所。</p> <p>在全局执行上下文中，变量环境对象就是全局对象（在浏览器中是<code>window</code>对象）。在函数执行上下文中，变量环境对象是活动对象（Activation Object）的一部分。</p> <p>需要注意的是，从ES6开始，JavaScript引入了词法环境的概念，<code>let</code>和<code>const</code>声明的变量存储在词法环境的词法绑定（Lexical Bindings）中，而不是变量环境对象中。</p> <h3 id="_6-2-变量环境对象的创建过程"><a href="#_6-2-变量环境对象的创建过程" class="header-anchor">#</a> 6.2 变量环境对象的创建过程</h3> <p>变量环境对象的创建遵循以下步骤：</p> <ol><li>创建一个空的对象</li> <li>将函数声明添加到对象中（函数提升）</li> <li>将通过<code>var</code>声明的变量添加到对象中，初始值为<code>undefined</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined (变量提升)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function: fn] (函数提升)</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_6-3-变量环境对象与词法环境的区别"><a href="#_6-3-变量环境对象与词法环境的区别" class="header-anchor">#</a> 6.3 变量环境对象与词法环境的区别</h3> <p>在ES6及之后的版本中，JavaScript引入了词法环境来存储<code>let</code>和<code>const</code>声明的变量，与变量环境对象形成对比：</p> <table><thead><tr><th>特性</th> <th>变量环境对象 (Variable Environment)</th> <th>词法环境 (Lexical Environment)</th></tr></thead> <tbody><tr><td>存储变量类型</td> <td><code>var</code>声明的变量和函数声明</td> <td><code>let</code>和<code>const</code>声明的变量</td></tr> <tr><td>变量提升</td> <td>会提升，初始值为<code>undefined</code></td> <td>会提升，但存在暂时性死区</td></tr> <tr><td>重复声明</td> <td>允许重复声明</td> <td>不允许重复声明</td></tr> <tr><td>作用域</td> <td>函数作用域</td> <td>块级作用域</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 变量环境对象存储var声明的变量</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>varVariable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
  <span class="token keyword">var</span> varVariable <span class="token operator">=</span> <span class="token string">'var'</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 词法环境存储let声明的变量</span>
  <span class="token comment">// console.log(letVariable); // ReferenceError: Cannot access 'letVariable' before initialization</span>
  <span class="token keyword">let</span> letVariable <span class="token operator">=</span> <span class="token string">'let'</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 块级作用域中的let变量</span>
    <span class="token keyword">let</span> blockVariable <span class="token operator">=</span> <span class="token string">'block let'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blockVariable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'block let'</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// console.log(blockVariable); // ReferenceError: blockVariable is not defined</span>
<span class="token punctuation">}</span>

<span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_6-4-变量环境对象的实际应用"><a href="#_6-4-变量环境对象的实际应用" class="header-anchor">#</a> 6.4 变量环境对象的实际应用</h3> <p>理解变量环境对象有助于理解变量提升和作用域的工作原理：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hoistingExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Function: b]</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: Cannot access 'c' before initialization</span>
  
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'var variable'</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'function'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token string">'let variable'</span><span class="token punctuation">;</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'var variable'</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'function'</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'let variable'</span>
<span class="token punctuation">}</span>

<span class="token comment">// hoistingExample(); // 取消注释以运行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>通过这个例子可以看出：</p> <ol><li><code>var</code>声明的变量<code>a</code>被提升到函数顶部，初始值为<code>undefined</code></li> <li>函数声明<code>b</code>被完整提升到函数顶部</li> <li><code>let</code>声明的变量<code>c</code>虽然也被提升，但由于暂时性死区的存在，在声明之前访问会报错</li></ol> <h2 id="_7-闭包"><a href="#_7-闭包" class="header-anchor">#</a> 7. 闭包</h2> <h3 id="_7-1-什么是闭包"><a href="#_7-1-什么是闭包" class="header-anchor">#</a> 7.1 什么是闭包</h3> <p>闭包是指有权访问另一个函数作用域中变量的函数，即使在外部函数返回后，这些变量仍然可以被访问和操作。</p> <p>更准确地说，闭包是函数和声明该函数的词法环境的组合。这个环境包含了函数创建时所能访问的所有局部变量、参数和内部函数。</p> <h3 id="_7-2-闭包的形成条件"><a href="#_7-2-闭包的形成条件" class="header-anchor">#</a> 7.2 闭包的形成条件</h3> <p>闭包的形成需要满足以下条件：</p> <ol><li>函数嵌套</li> <li>内部函数引用了外部函数的变量</li> <li>外部函数返回了内部函数</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outerFunction</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 外部函数的局部变量</span>
  <span class="token comment">// eslint-disable-next-line</span>
  <span class="token keyword">var</span> outerVariable <span class="token operator">=</span> x<span class="token punctuation">;</span>
  
  <span class="token comment">// 内部函数</span>
  <span class="token keyword">function</span> <span class="token function">innerFunction</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 内部函数访问外部函数的变量</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>outerVariable <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 返回内部函数，形成闭包</span>
  <span class="token keyword">return</span> innerFunction<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> closure <span class="token operator">=</span> <span class="token function">outerFunction</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">closure</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 15</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_7-3-闭包的特点"><a href="#_7-3-闭包的特点" class="header-anchor">#</a> 7.3 闭包的特点</h3> <ol><li><strong>变量持久化</strong>：闭包可以使得外部函数的局部变量在函数执行完毕后仍然保存在内存中</li> <li><strong>数据封装</strong>：可以创建私有变量，外部无法直接访问</li> <li><strong>模块化</strong>：可以创建具有私有状态的模块</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 计数器示例</span>
<span class="token keyword">function</span> <span class="token function">createCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      count<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">decrement</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      count<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getCount</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token function">createCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_7-4-闭包的应用场景"><a href="#_7-4-闭包的应用场景" class="header-anchor">#</a> 7.4 闭包的应用场景</h3> <ol><li><strong>模块模式</strong>：创建具有私有变量和方法的对象</li> <li><strong>回调函数</strong>：在异步操作中保持对变量的访问</li> <li><strong>函数工厂</strong>：创建具有特定行为的函数</li> <li><strong>事件处理</strong>：在事件处理器中保持对变量的引用</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 模块模式示例</span>
<span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> privateVariable <span class="token operator">=</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>privateVariable<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">publicMethod</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">privateFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">setPrivateVariable</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      privateVariable <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myModule<span class="token punctuation">.</span><span class="token function">publicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: Hello</span>
myModule<span class="token punctuation">.</span><span class="token function">setPrivateVariable</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myModule<span class="token punctuation">.</span><span class="token function">publicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: World</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_7-5-闭包的注意事项"><a href="#_7-5-闭包的注意事项" class="header-anchor">#</a> 7.5 闭包的注意事项</h3> <ol><li><strong>内存消耗</strong>：由于闭包会使得函数中的变量都被保存在内存中，内存消耗较大，所以不能滥用闭包</li> <li><strong>性能影响</strong>：过多的闭包可能会影响性能</li> <li><strong>调试困难</strong>：闭包可能会使调试变得复杂</li> <li><strong>变量共享</strong>：多个闭包可能共享同一个变量</li></ol> <h3 id="_7-6-闭包常见问题及解决方案"><a href="#_7-6-闭包常见问题及解决方案" class="header-anchor">#</a> 7.6 闭包常见问题及解决方案</h3> <h4 id="循环中的闭包问题"><a href="#循环中的闭包问题" class="header-anchor">#</a> 循环中的闭包问题</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 问题代码</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>解决方案1：使用立即执行函数表达式（IIFE）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>解决方案2：使用let声明变量（ES6）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_7-7-闭包题目"><a href="#_7-7-闭包题目" class="header-anchor">#</a> 7.7 闭包题目</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">myName</span><span class="token operator">:</span> <span class="token string">'www.blog.huoyuhao.net'</span><span class="token punctuation">,</span>
  <span class="token function">printName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> myName <span class="token operator">=</span> <span class="token string">'huoyuhao'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bar<span class="token punctuation">.</span>printName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myName <span class="token operator">=</span> <span class="token string">'liam'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token punctuation">.</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="https://time.geekbang.org/column/intro/100033601" target="_blank" rel="noopener noreferrer">极客时间课程 -- 浏览器工作原理与实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5c8290455188257e5d0ec64f" target="_blank" rel="noopener noreferrer">深入理解JavaScript作用域和作用域链<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5b081f8d6fb9a07a9b3664b6" target="_blank" rel="noopener noreferrer">闭包详解一<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/29/2025, 5:36:30 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/2-Js基础/01-Js正则表达式.html" class="prev">
        Js正则表达式
      </a></span> <span class="next"><a href="/web/2-Js基础/03-Js中This.html">
        Js中This
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.fdbd3a7d.js" defer></script><script src="/assets/js/2.c135791f.js" defer></script><script src="/assets/js/1.ef243348.js" defer></script><script src="/assets/js/69.5cb10b3a.js" defer></script>
  </body>
</html>
