---
meta:
  - name: description
    content: 从输入URL到页面展示
  - name: keywords
    content: 从输入URL到页面展示,URL,页面渲染,前端,
---
# 从输入URL到页面展示

从URL到页面展示都经历了那些内容？我先把结果放出来，之后在一章一章的具体介绍相应的知识点

## 用户输入

+ 用户输入内容，点击回车，这意味着当前页面需要关闭，会调用当前页面的`beforeunload`事件。此事件使网页能够触发一个确认对话框，询问用户是否真的要离开该页面。如果用户确认，浏览器将导航到新页面，否则导航将会取消；

+ 浏览器判断用户输入URL是否合法，如果不合法，则调用默认的搜索引擎，来合成新的带搜索关键字的URL；

+ 如果输入内容是URL，浏览器检查请求是HTTPS还是HTTP，协议默认为http。有些情况下，第一个请求不是HTTPS的，但是当浏览器向网站发出第一个HTTP请求之后，网站会返回浏览器一个响应，请求浏览器使用HTTPS发送请求；

完整的URL是由协议（比如http，ftp）、域名（比如`http://www.baidu.com`）、文件路径（比如/src/index.html这样的）和端口（比如:80）四个部分组成，如果内容不齐，协议默认为http，文件路径默认为空（虽然服务器接收到的是空的文件名，但是一般会在服务器端补全为index.html），端口默认为80端口。

HSTS（HTTP Strcit-Transport-Securit）的作用是强制客户端（如浏览器）使用HTTPS与服务器创建连接。服务器开启HSTS的方法是，当客户端通过HTTPS发出请求时，在服务器返回的超文本传输协议（HTTP）响应头中包含Strict-Transport-Security字段。非加密传输时设置的HSTS字段无效。这是一种 Web 安全策略机制，可保护网站免受协议降级攻击和 cookie 劫持、中间人攻击。

Chrome 浏览器关闭HSTS操作。地址栏中输入 chrome://net-internals/#hsts、在 Delete domain 中输入项目的域名，并Delete 删除、可以在 Query domain 测试是否删除成功

### 即沿用当前页面协议，不要写死协议，这样有利于以后协议升级，比如http升级为https

## URL 请求过程

+ 浏览器进程会通过进程间通信（IPC）把 URL 请求发送至网络进程，网络进程接收到 URL 请求后，会在这里发起真正的 URL 请求流程

+ 网络进程查找浏览器缓存是否存在该资源，如果命中该资源且没有过期，直接返回资源给浏览器进程

+ 如果没有命中缓存资源，直接进入网络请求流程

+ DNS解析查找IP地址

+ TCP三次握手，浏览器连接服务器

+ 如果有重定向，返回第一步，重新发送请求

+ 如果是HTTPS协议，需要通过SSL协议，需要先进性SSL协议握手，如果有提交数据，数据加密传输给服务器

## 服务器响应

+ 服务器接收HTTP请求，解析请求头、请求题、请求行

+ 根据请求路径参数，处理请求逻辑

+ 生成一个HTTP响应，包括状态行、响应头、响应体

## 浏览器渲染过程

+ 浏览器接收响应，根据请求头解析响应体

+ 解析HTML文档，构建DOM树

+ 解析CSS文件和内联样式，构建CSS树

+ 执行脚本

+ 结合DOM树和CSS树，构建render树

+ 布局：浏览器根据渲染树计算每个元素的准确位置和大小，确定页面的布局。

+ 绘制：浏览器遍历渲染树，将每个元素绘制到屏幕上。

+ 合成：在某些情况下，浏览器会将页面分成多个层进行绘制。最后，这些层会按照特定顺序合成为最终的页面视图。

+ 加载图片资源、请求和用户交互

